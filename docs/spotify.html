<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Now Playing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        .player-container {
            background-color: #282828;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 300px;
        }
        .track-info {
            text-align: center;
            margin-bottom: 10px;
        }
        .track-info h2 {
            margin: 0;
            font-size: 18px;
        }
        .track-info p {
            margin: 0;
            font-size: 14px;
            color: #b3b3b3;
        }
        .progress-container {
            width: 100%;
            margin-bottom: 10px;
        }
        .progress-bar {
            width: 100%;
            height: 5px;
            background-color: #535353;
            border-radius: 2.5px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background-color: #1db954;
            width: 0;
        }
        .controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }
        .controls button {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="track-info">
            <h2 id="track-name">Loading...</h2>
            <p id="artist-name">Please wait</p>
        </div>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 12px;">
                <span id="current-time">0:00</span>
                <span id="duration">0:00</span>
            </div>
        </div>
        <div class="controls">
            <button id="prev-button">⏮️</button>
            <button id="play-pause-button">⏸️</button>
            <button id="next-button">⏭️</button>
        </div>
    </div>

    <script>
        async function updatePlayer() {
            try {
                const response = await fetch('/currently-playing');
                const data = await response.json();

                if (data && data.is_playing) {
                    const trackName = data.item.name;
                    const artistName = data.item.artists.map(artist => artist.name).join(', ');
                    const albumArt = data.item.album.images[0].url;
                    const progress = data.progress_ms;
                    const duration = data.item.duration_ms;

                    document.getElementById('track-name').textContent = trackName;
                    document.getElementById('artist-name').textContent = artistName;
                    document.getElementById('current-time').textContent = formatTime(progress);
                    document.getElementById('duration').textContent = formatTime(duration);

                    const progressBar = document.getElementById('progress-bar');
                    const progressPercentage = (progress / duration) * 100;
                    progressBar.style.width = progressPercentage + '%';
                } else {
                    document.getElementById('track-name').textContent = 'No track currently playing';
                    document.getElementById('artist-name').textContent = '';
                    document.getElementById('current-time').textContent = '0:00';
                    document.getElementById('duration').textContent = '0:00';
                    document.getElementById('progress-bar').style.width = '0%';
                }
            } catch (error) {
                console.error('Error fetching currently playing track:', error);
            }
        }

        function formatTime(ms) {
            const minutes = Math.floor(ms / 60000);
            const seconds = ((ms % 60000) / 1000).toFixed(0);
            return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        // Update the player every 5 seconds
        setInterval(updatePlayer, 5000);

        // Initial load
        updatePlayer();
    </script>
</body>
</html>
